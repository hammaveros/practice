# ===========================================
# Consumer 애플리케이션 설정
# ===========================================

server:
  port: 8081  # Consumer는 8081 포트 (Producer와 충돌 방지)

spring:
  application:
    name: kafka-consumer

  kafka:
    # ===========================================
    # Kafka 브로커 연결 설정
    # ===========================================
    bootstrap-servers: localhost:9092,localhost:9093,localhost:9094

    consumer:
      # -----------------------------
      # Consumer Group 설정
      # -----------------------------
      group-id: order-consumer-group
      # 같은 group-id를 가진 Consumer들이 파티션을 나눠 가짐
      # 다른 group-id면 같은 메시지를 각각 받음

      # -----------------------------
      # 오프셋 설정
      # -----------------------------
      auto-offset-reset: earliest
      # earliest: 처음부터 읽기 (새 Consumer Group일 때)
      # latest: 최신 메시지부터 읽기
      # none: 오프셋 없으면 에러

      enable-auto-commit: false
      # false: 수동 커밋 (처리 완료 후 커밋)
      # true: 자동 커밋 (5초마다, 처리 실패해도 커밋됨)

      # -----------------------------
      # 역직렬화 설정
      # -----------------------------
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer

      properties:
        # JSON → 객체 변환 시 신뢰할 패키지
        spring.json.trusted.packages: "com.practice.*"
        # 보안상 모든 패키지를 신뢰하지 않고 우리 패키지만 허용

        # 타입 정보가 없을 때 기본 타입
        spring.json.value.default.type: "com.practice.common.event.OrderCreatedEvent"

      # -----------------------------
      # 성능 설정
      # -----------------------------
      max-poll-records: 500
      # 한 번에 가져올 최대 레코드 수

      fetch-min-size: 1
      # 최소 이만큼 데이터 있어야 fetch (바이트)

      fetch-max-wait: 500ms
      # 최소 크기 안 채워도 이 시간 지나면 fetch

    # ===========================================
    # Listener 설정
    # ===========================================
    listener:
      ack-mode: manual
      # manual: @KafkaListener에서 수동으로 acknowledge
      # record: 레코드마다 자동 커밋
      # batch: 배치마다 자동 커밋

      concurrency: 3
      # 파티션 수에 맞춰 설정 (파티션 3개면 3)
      # Consumer 스레드 수

# ===========================================
# 로깅 설정
# ===========================================
logging:
  level:
    root: INFO
    com.practice: DEBUG
    org.apache.kafka: WARN
